<!DOCTYPE html >

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="robots" content="noindex">
    <meta name="description" content="">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="theme/js/custom.js"></script>
    <title>Container/HBL Tracking</title>
    <link rel="stylesheet" type="text/css" href="theme/css/style.css">
    <!--<link rel="stylesheet" type="text/css" href="maeu.css">-->
</head>

<body>
       
    <div id="logo">
        <img src="theme/img/logo.png" alt="logo" style="height:50px;">
    </div>
    <div class="loader-wrapper" id="loader-1">
        <div id="loader"> </div>
    </div>
    <div id="cover-div">
        <form id="form1" name="form1" method="post" action="/hander">
            <div class="containerSearch">
                <div class="rowSearch">
                    <div class="col-75">
                        <input type="text" id ="container" placeholder="Container No." value="" name="Container">
                        <select id="option"name="line">
                            <option value="" selected="selected">SEALINE...</option>
                            <option value="maersk">MAERSK</option>
                            <option value="msc">MSC</option>
                            <option value="cma-cgm">CMA-CGM</option>
                            <option value="hamburgsud">HAMBURG SUD</option>
                            <option value="hapag">HAPAG-LLOYD</option>
                            <option value="one">ONE</option>
                        </select>
                        <input id="searchBtn" type="button" value="Search" onClick="javascript:showLoading()" /> 
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div id="content_loadport"><img src="theme/img/container_ship_loading-128.png" height="25" alt="">Load:Tue, June 04, 2019
        <br><strong>Qui Nhon</strong></div>
    <div id="content_destport"><img src="theme/img/dest-port-icon.png" height="25" alt="">Arrival:Thu, July 18, 2019
        <br><strong>Constanta</strong></div>
    <div id="content_shipBB"><strong>CARRIER</strong></br><img src="theme/img/ship.jpg" height="50" alt=""></div>
    
    <div id="map"></div>
    <div id="table"  style="display:none;" class="answer_list" >
        <div align="center"></div>
          <div class="collapse-side-panel">
              <img id="cancelBtn" src="theme/img/close.png">
              <img id="arrow" src="theme/img/arrow-left.png">
          </div>
          <div id="contentinfo">
              <iframe src="info-table.html" name="frame2" id="frame2" frameborder="0" marginwidth="" marginheight="" scrolling="auto" onload="" allowtransparency="false">
              </iframe>
          </div>
      </div>
     
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <script> 
var mapOptions = {
        zoom: 3,
        center: new google.maps.LatLng(0, 60),
    }
var map = new google.maps.Map(document.getElementById('map'), mapOptions);
function initialize() {
    
    var polyOptions = {
        geodesic: false,
        strokeColor: '#FF0000',
        strokeOpacity: 1.0,
        strokeWeight: 2,
        editable: true,
    }
    var poly = new google.maps.Polyline(polyOptions);
    poly.setMap(map);
    //Call draw area here
    //drawArea();
    //markArea();
    //drawMainRoute();
    //drawShipRoute();
    google.maps.event.addListener(map, "click", function(event) {
        var path = poly.getPath();
        path.push(event.latLng);
        var coordinates_poly = poly.getPath().getArray();
        var newCoordinates_poly = [];
        for (var i = 0; i < coordinates_poly.length; i++) {
            lat_poly = coordinates_poly[i].lat();
            lng_poly = coordinates_poly[i].lng();
            latlng_poly = [lat_poly, lng_poly];
            newCoordinates_poly.push(latlng_poly);
        }
        var str_coordinates_poly = JSON.stringify(newCoordinates_poly);
        var json_poly = "{\"ToaDo\":" + str_coordinates_poly + "}";
        document.getElementById('json_polyline').value = json_poly;
    });
    function drawArea() {
        for (let i = -180; i < 180; i += 5) {
            let longitude = [
                { lat: 85, lng: i },
                { lat: -85, lng: i }
            ]
            let flightPath = new google.maps.Polyline({
                path: longitude,
                strokeColor: '#351fdb',
                strokeOpacity: 0.5,
                strokeWeight: 2
            });
            flightPath.setMap(map);
        }
        for (let i = -80; i < 90; i += 5) {
            let latitude = [
                { lat: i, lng: -180 },
                { lat: i, lng: 0 },
                { lat: i, lng: 180 }
            ]
            let flightPath = new google.maps.Polyline({
                path: latitude,
                strokeColor: '#a11cad',
                strokeOpacity: 0.5,
                strokeWeight: 2
            });
            flightPath.setMap(map);
        }
    }
    function markArea() {
        let areaLat, areaLng;
        for (let lng = -179; lng < 180; lng += 5) {
            areaLng = Math.ceil((180-lng)/5);
            for (let lat = -81; lat < 80; lat += 5) {
                areaLat = Math.ceil((90-lat)/5);
                let latLng = { lat: lat, lng: lng };
                let image = {
                    url: 'info.png',
                    anchor: new google.maps.Point(5, 5),
                    scaledSize: new google.maps.Size(10, 10)
                };
                let harborLocation = new google.maps.Marker({
                    position: latLng,
                    title: `AreaLat: ${areaLat} \nAreaLong: ${areaLng}`,
                    icon: image,
                    map: map
                });
            }
        }
    }
    // DANGEROUS
    function drawMainRoute(){
        fetch('http://api.track4cargo.com/getAllVertexes')
            .then(response => response.json())
            .then(data => {
                data.forEach(vertex => {
                    mark(vertex)
                })
            })
    }
    function mark(vertex) {
        let latLng = { lat: vertex.coordinate[0], lng: vertex.coordinate[1] };
        let image = {
            url: 'point.png',
            anchor: new google.maps.Point(5, 5),
            scaledSize: new google.maps.Size(10, 10)
        };
        let harborLocation = new google.maps.Marker({
            position: latLng,
            title: `ID: ${vertex._id}`,
            icon: image,
            map: map
        });
    }
}
function drawShipRoute(src, des, shipCoor = []){
    fetch('http://api.track4cargo.com/', {
      method: 'post',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        startPort: src,
        endPort: des,
        shipCoordinate: shipCoor
      })
    })
    .then(response => response.json())
    .then(data =>{
        //console.log(data);
        drawLine(data);
    });
    markShip(shipCoor);
}
function getRoute(listPortName, lastVisitedPortName, shipCoor = []) {
    let apiURL = 'http://api.track4cargo.com/getRoute' +
                             '?listPortName=' + listPortName +
                             '&lastVisitedPortName=' + lastVisitedPortName +
                             '&shipCoordinate=' +shipCoor; 
    fetch(apiURL)
        .then(response => response.json())
        .then(data => {
            console.log(data);
            drawLine(data);
            markShip(shipCoor);
            markPort(listPortName[0], data[0], 'start');
            markPort(listPortName[listPortName.length - 1], data[data.length-1], 'end');
        });
}
function drawLine(route){
    flightPlanCoordinates = [];
    for(i = 0; i < route.length; i++){
        flightPlanCoordinates.push({lat: route[i][0], lng: route[i][1]});
    }
    let flightPath = new google.maps.Polyline({
        path: flightPlanCoordinates,
        strokeColor: '#FF0000',
        strokeOpacity: 1.0,
        strokeWeight: 2
        });
    flightPath.setMap(map);
}
function markShip(shipCoordinate){
  let latLng = {lat: shipCoordinate[0], lng: shipCoordinate[1]};
  let image = {
    url: 'waveship.gif',
    anchor: new google.maps.Point(25, 25),
    scaledSize: new google.maps.Size(50, 50)
  };
  const harborLocation = new google.maps.Marker({
    position: latLng, 
    icon: image,
    map: map
  });
}
function markPort(portName, coordinate, portType){
  let latLng = {lat: coordinate[0], lng: coordinate[1]};
  
  let imgUrl = '';
  if(portType === 'start')
    imgUrl = 'startdot.png';
  else if(portType === 'end')
    imgUrl = 'enddot.png'
  let image = {
    url: imgUrl,
    anchor: new google.maps.Point(5, 5),
    scaledSize: new google.maps.Size(10, 10)
  };
  const harborLocation = new google.maps.Marker({
    position: latLng, 
    icon: image,
    map: map,
    title: portName
  });
}
google.maps.event.addDomListener(window, 'load', initialize);
</script>
    <script>
        /*
    $.getJSON('http://time.jsontest.com', function(data1) {
       
        var text = `Date: ${data1.date}<br>
                    Time: ${data1.time}<br>
                    Unix time: ${data1.milliseconds_since_epoch}`
                var x=`${data1.date}`
      //  $(".mypanel").html(text);
        alert(x);
        
        //var date=${data1.date};
        //alert(${data1.date});
    });
    */
    </script>
    <script>
        var x = document.getElementById("loader");
        x.style.display = "none";
        var map, popup_discharge, popup_load, popup_dest, popup_ship, Popup;
        /* Initializes the map and the custom popup. */
        function initMap() {
            definePopupClass();
            map = new google.maps.Map(document.getElementById('map'), {
                center: new google.maps.LatLng(0, 60),
                mapTypeControl: false,
                streetViewControl: false,
                zoom: 3
            });
            var polyOptions = {
            geodesic: false,
            strokeColor: '#00FF00',
            strokeOpacity: 1.0,
            strokeWeight: 2,
            editable: true,
            }
            var poly = new google.maps.Polyline(polyOptions);
            poly.setMap(map);
            popup_load = new Popup(
                new google.maps.LatLng(13.7829673, 109.2196634),
                document.getElementById('content_loadport'));
            popup_load.setMap(map);
            var marker = new google.maps.Marker({
                position: {
                    lat: 13.7829673,
                    lng: 109.2196634
                },
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 4.5,
                    fillColor: "#F00",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4
                },
                map: map
            });
            popup_dest = new Popup(
                new google.maps.LatLng(44.1598013, 28.6348138),
                document.getElementById('content_destport'));
            popup_dest.setMap(map);
            var marker2 = new google.maps.Marker({
                position: {
                    lat: 44.1598013,
                    lng: 28.6348138
                },
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 4.5,
                    fillColor: "#F00",
                    fillOpacity: 0.4,
                    strokeWeight: 0.4
                },
                map: map
            });
            popup_ship = new Popup(
                new google.maps.LatLng(37.40106, 24.7273),
                document.getElementById('content_shipBB'));
            popup_ship.setMap(map);
            var markerImage = new google.maps.MarkerImage('theme/img/bluedot.png', null, // size
                null, // origin
                new google.maps.Point(8, 6), // anchor (move to center of marker)
                new google.maps.Size(15, 15) // scaled size (required for Retina display icon)
            );
            var marker3 = new google.maps.Marker({
                map: map,
                draggable: false,
                optimized: false,
                flat: true,
                visible: true,
                icon: markerImage,
                title: 'Your container might be here',
                animation: google.maps.Animation.DROP,
                // map default location set in Tehran location
                position: {
                    lat: 37.40106,
                    lng: 24.7273
                }
            });
        }
        /** Defines the Popup class. */
        function definePopupClass() {
            /**
             * A customized popup on the map.
             * @param {!google.maps.LatLng} position
             * @param {!Element} content
             * @constructor
             * @extends {google.maps.OverlayView}
             */
            Popup = function(position, content) {
                this.position = position;
                content.classList.add('popup-bubble-content');
                var pixelOffset = document.createElement('div');
                pixelOffset.classList.add('popup-bubble-anchor');
                pixelOffset.appendChild(content);
                this.anchor = document.createElement('div');
                this.anchor.classList.add('popup-tip-anchor');
                this.anchor.appendChild(pixelOffset);
                // Optionally stop clicks, etc., from bubbling up to the map.
                this.stopEventPropagation();
            };
            // NOTE: google.maps.OverlayView is only defined once the Maps API has
            // loaded. That is why Popup is defined inside initMap().
            Popup.prototype = Object.create(google.maps.OverlayView.prototype);
            /** Called when the popup is added to the map. */
            Popup.prototype.onAdd = function() {
                this.getPanes().floatPane.appendChild(this.anchor);
            };
            /** Called when the popup is removed from the map. */
            Popup.prototype.onRemove = function() {
                if (this.anchor.parentElement) {
                    this.anchor.parentElement.removeChild(this.anchor);
                }
            };
            /** Called when the popup needs to draw itself. */
            Popup.prototype.draw = function() {
                var divPosition = this.getProjection().fromLatLngToDivPixel(this.position);
                // Hide the popup when it is far out of view.
                var display =
                    Math.abs(divPosition.x) < 4000 && Math.abs(divPosition.y) < 4000 ?
                    'block' :
                    'none';
                if (display === 'block') {
                    this.anchor.style.left = divPosition.x + 'px';
                    this.anchor.style.top = divPosition.y + 'px';
                }
                if (this.anchor.style.display !== display) {
                    this.anchor.style.display = display;
                }
            };
            /** Stops clicks/drags from bubbling up to the map. */
            Popup.prototype.stopEventPropagation = function() {
                var anchor = this.anchor;
                anchor.style.cursor = 'auto';
                ['click', 'dblclick', 'contextmenu', 'wheel', 'mousedown', 'touchstart',
                    'pointerdown'
                ]
                .forEach(function(event) {
                    anchor.addEventListener(event, function(e) {
                        e.stopPropagation();
                    });
                });
            };
        }
            
     //  $.ajax({ 
           //    url: 'http://api.track4cargo.com/getInfo.php', 
           //    success: function(data) 
   // { alert(data); } 
           //   {console.log(data);}
           //   });
           
       function get_json()
       {
               var Port_From;
               var Port_Dest;
               var Cor1;
               var Cor2;
               var Port_code1;
               var Port_code2;
                var Container_No=document.getElementById("container").value;
                var op=document.getElementById("option").value;
                   
                  $.getJSON('http://localhost/test/tracking/theme/data.json', function(data) {
                    
                 Port_From=`${data.PortFrom}`
                 Port_Dest=`${data.PortDest}`
                 Cor1=`${data.cor1}`
                 Cor2=`${data.cor2}`
                   console.log('a');
                var xhttp = new XMLHttpRequest();
                 xhttp.onreadystatechange = function() 
               {
               if (this.readyState == 4 && this.status == 200) 
               {
                var responseResult =this.responseText;
                var PortCodeFrom = responseResult[0];
                 var PortCodeDest;
                 responseResult= JSON.parse(responseResult);
                 Port_From_code=responseResult.Port_From.toLowerCase();
                 Port_Dest_code=responseResult.Port_Dest.toLowerCase();
                 alert(Port_From_code);
                 alert(Port_Dest_code);
                  
             };
             //alert(Port_code1);
             //alert(Port_code2);
               }
            xhttp.open("GET", "http://localhost:3000/data?Port_From="+ Port_From +"&Port_Dest="+ Port_Dest+"&Port_code1="+ Port_code1+"&Port_code2="+ Port_code2, true);
         
           xhttp.send();
               
                 });
                 
        }
           // get_json();
        function showLoading() {
                     get_json();
                     document.getElementById('table').style.display = "block";
                          }
    </script>
   

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNQtfi4C8QpQHBwTMqmNOufW-lPrPn-i8&callback=initMap&maptype=roadmap"></script>
</body>

</html>